{% extends 'layout-app.html' %}

{% set hub = "Your health" %}

{% set backLink = true %}
{% set backLinkURL = "/pages/home-p9" %}

{% set pageHeading = "Vaccines and health checks" %}
{% set pageDescription = "What you need to book, what's coming up, and what you've had" %}

{% macro programmeCards(programmes, heading) %}
  {% if programmes.length %}
    {% set cards = [] %}
    {% for prog in programmes %}
      {% set cardHtml %}
        <div class="nhsapp-card__below">
          <p class="nhsapp-card__description">{{ prog.description }}</p>
          {% if prog.statusText and prog.statusText !== prog.description %}
            <p class="nhsapp-card__description">{{ prog.statusText }}</p>
          {% endif %}
        </div>
      {% endset %}
      {% set cards = (cards.push({ title: prog.name, href: "#", descriptionHtml: cardHtml }), cards) %}
    {% endfor %}
    {{ nhsappCardGroup({
      stacked: true,
      heading: heading,
      cards: cards
    }) }}
  {% endif %}
{% endmacro %}

{% block content %}

  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">
      <h1 class="nhsuk-heading-xl nhsuk-u-margin-bottom-5">
        {{ pageHeading }}
      </h1>
      <p>
        Look after your health by stopping illness or catching it early.
      </p>

      {{ programmeCards(grouped.actionNeeded, "Book now") }}
      {{ programmeCards(grouped.inProgress, "In progress") }}
      {{ programmeCards(grouped.upcoming, "Coming up") }}
      {{ programmeCards(grouped.unknown, "Check if these are available to you") }}


      {# Links                                    #}

      <ul class="nhsuk-list nhsuk-u-margin-top-6">
        {% if grouped.upToDate.length %}
          <li>
            <a href="/pages/your-health/vaccines-and-health-checks-history">Up to date ({{ grouped.upToDate.length }})</a>
          </li>
        {% endif %}
        {% if grouped.optedOut.length %}
          <li>
            <a href="/pages/your-health/vaccines-and-health-checks-opted-out">Things you've opted out of ({{ grouped.optedOut.length }})</a>
          </li>
        {% endif %}
      </ul>

      {# Up to date — debug                          #}
      {% if grouped.upToDate.length %}
        <p style="font-size: 14px; color: #666;">
          <strong>Up to date:</strong><br>
          {% for prog in grouped.upToDate %}
            {{ prog.name }}: {{ prog.statusText }} — {{ prog.reasonText }}<br>
          {% endfor %}
        </p>
      {% endif %}

      {# Opted out — debug                          #}
      {% if grouped.optedOut.length %}
        <p style="font-size: 14px; color: #666;">
          <strong>Opted out:</strong><br>
          {% for prog in grouped.optedOut %}
            {{ prog.name }}: {{ prog.reasonText }}<br>
          {% endfor %}
        </p>
      {% endif %}

      {# Debug: not eligible                        #}
      {% if excluded.length %}
        <hr style="margin-top: 32px;">
        <p style="font-size: 14px; color: #666;">
          <strong>Not eligible for ({{ excluded.length }}):</strong><br>
          {% for prog in excluded %}
            {{ prog.name }} — {{ prog.reason }}<br>
          {% endfor %}
        </p>
      {% endif %}

    </div>
  </div>

{% endblock %}
