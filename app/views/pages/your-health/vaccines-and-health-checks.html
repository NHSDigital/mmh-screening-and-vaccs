{% extends 'layout-app.html' %}

{% set hub = "Your health" %}

{% set backLink = true %}
{% set backLinkURL = "/pages/home-p9" %}

{% set pageHeading %}
  Your vaccines and health&nbsp;checks
{% endset %}
{% set pageDescription = "Your upcoming and past vaccines and health checks" %}

{% set dueCards = [] %}
{% set upcomingCards = [] %}
{% set unknownCards = [] %}
{% set completeCards = [] %}
{% set partialCards = [] %}
{% set optedOutCards = [] %}

{% for prog in programmes %}
  {% set description = prog.scheduleDescription %}
  {% set card = { title: prog.name, href: "#", description: description } %}

  {% if prog.status == "due" %}
    {% if prog.overdueBy %}
      {% set description = prog.overdueBy | formatOverdue %}
    {% elif prog.lastDate %}
      {% set description = "You had this " + prog.lastDate | relativeDate %}
    {% endif %}
    {% set card = { title: prog.name, href: "#", description: description } %}
    {% set dueCards = (dueCards.push(card), dueCards) %}

  {% elif prog.status == "upcoming" %}
    {% if prog.nextDueDate %}
      {% set description = "Due: " + prog.nextDueDate | relativeDate %}
    {% endif %}
    {% set card = { title: prog.name, href: "#", description: description } %}
    {% set upcomingCards = (upcomingCards.push(card), upcomingCards) %}

  {% elif prog.status == "unknown" %}
    {% if prog.eligibilityReasons.length %}
      {% set description = "You may be eligible because " + prog.eligibilityReasons | join(" and ") %}
    {% endif %}
    {% set card = { title: prog.name, href: "#", description: description } %}
    {% set unknownCards = (unknownCards.push(card), unknownCards) %}

  {% elif prog.status == "complete" %}
    {% if prog.lastDate %}
      {% set description = "<br> You had this " + prog.lastDate | relativeDate %}
      {% if prog.nextDueDate %}
        {% set description = description + "<br> Next due " + prog.nextDueDate | relativeDate %}
      {% endif %}
    {% endif %}
    {% set card = { title: prog.name, href: "#", descriptionHtml: description } %}
    {% set completeCards = (completeCards.push(card), completeCards) %}

  {% elif prog.status == "partial" %}
    {% if prog.lastDate %}
      {% set description = "Last dose " + prog.lastDate | relativeDate %}
      {% if prog.doses and prog.requiredDoses %}
        {% set description = description + " (" + prog.doses + " of " + prog.requiredDoses + " doses)" %}
      {% endif %}
    {% endif %}
    {% set card = { title: prog.name, href: "#", description: description } %}
    {% set partialCards = (partialCards.push(card), partialCards) %}

  {% elif prog.status == "opted-out" %}
    {% set card = { title: prog.name, href: "#", description: "You have opted out" } %}
    {% set optedOutCards = (optedOutCards.push(card), optedOutCards) %}
  {% endif %}
{% endfor %}

{% block content %}

  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">
      <h1 class="nhsuk-heading-xl nhsuk-u-margin-bottom-5">
        {{ pageHeading | safe }}
      </h1>
      <p>
        Look after your health by stopping or catching illness early.
      </p>

      {% if dueCards.length %}
        {{ nhsappCardGroup({
          stacked: true,
          heading: "Book now",
          cards: dueCards
        }) }}
      {% endif %}

      {% if upcomingCards.length %}
        {{ nhsappCardGroup({
          stacked: true,
          heading: "Upcoming",
          cards: upcomingCards
        }) }}
      {% endif %}

      {% if partialCards.length %}
        {{ nhsappCardGroup({
          stacked: true,
          heading: "In progress",
          cards: partialCards
        }) }}
      {% endif %}

      {% if unknownCards.length %}
        {{ nhsappCardGroup({
          stacked: true,
          heading: "Check if youâ€™re eligible",
          cards: unknownCards
        }) }}
      {% endif %}

      {% if optedOutCards.length %}
        {{ nhsappCardGroup({
          stacked: true,
          heading: "Opted out",
          cards: optedOutCards
        }) }}
      {% endif %}

      {% if completeCards.length %}
        {{ nhsappCardGroup({
          stacked: true,
          heading: "Past",
          cards: completeCards
        }) }}
      {% endif %}

      {# To do proxy vaccines and health checks #}

    </div>
  </div>

{% endblock %}
